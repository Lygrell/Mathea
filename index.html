<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#fce7f3">
  <title>Daily Check</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      -webkit-font-smoothing: antialiased;
      background-color: #fce7f3;
      overscroll-behavior-y: contain;
    }
    #root { min-height: 100vh; }
    
    input[type="number"], input[type="text"] { font-size: 16px !important; }
    
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 44px;
      background: transparent;
      touch-action: none !important;
      cursor: pointer;
      outline: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 4px 12px rgba(251, 113, 133, 0.4);
      border: 2px solid #fb7185;
      margin-top: -13px;
    }
    
    input[type="range"]::-webkit-slider-runnable-track {
      width: 100%;
      height: 6px;
      background: #fbcfe8;
      border-radius: 3px;
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
    button { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body>
  <div id="root">Loading...</div>

  <script type="text/babel">
    const { useState, useEffect, memo, useCallback } = React;

    // Icons
    const Plus = () => <span style={{fontSize: '24px', fontWeight: 'bold'}}>+</span>;
    const Minus = () => <span style={{fontSize: '24px', fontWeight: 'bold'}}>‚àí</span>;
    const Play = () => <span style={{fontSize: '24px'}}>‚ñ∂</span>;
    const Calendar = () => <span style={{fontSize: '24px'}}>üìÖ</span>;
    const Settings = () => <span style={{fontSize: '24px'}}>‚öôÔ∏è</span>;
    const TrendingUp = ({ style }) => <span style={{fontSize: '20px', ...style}}>üìà</span>;
    const Flame = ({ style }) => <span style={{fontSize: '32px', ...style}}>üî•</span>;

    // Constants
    const workoutIcons = { run: 'üèÉ', strength: 'üí™', padel: 'üéæ' };
    const intensityColors = { low: '#86efac', moderate: '#fcd34d', high: '#fb7185' };

    // Helper functions
    const getCalorieColor = (value, goal) => {
      const percentDiff = (Math.abs(value - goal) / goal) * 100;
      if (percentDiff <= 5) return '#86efac';
      if (percentDiff <= 15) return '#fbbf24';
      return '#fb7185';
    };

    const getProteinColor = getCalorieColor;

    const getProgressColor = (value, goal, multiplier) => {
      const percent = (value / goal) * 100;
      if (value === 0) return '#fb7185';
      if (percent < 75) return '#fb7185';
      if (percent < 100) return '#fbbf24';
      if (value >= goal * multiplier) return '#fde047';
      return '#86efac';
    };

    const getProgress = (value, goal) => Math.min(100, (value / goal) * 100);

    const getActivityScore = (dayData, goals) => {
      if (!dayData) return 0;
      const scores = [
        (dayData.calories / goals.calories) * 100,
        (dayData.protein / goals.protein) * 100,
        (dayData.workoutMinutes / goals.workout) * 100,
        (dayData.pushups / goals.pushups) * 100,
        (dayData.plank / goals.plank) * 100
      ];
      return scores.reduce((a, b) => a + Math.min(100, b), 0) / 5;
    };

    const getActivityColor = (score) => {
      if (score === 0) return '#fce7f3';
      if (score < 25) return '#fda4af';
      if (score < 50) return '#fbbf24';
      if (score < 75) return '#fcd34d';
      return '#86efac';
    };

    // StatusCircle component
    const StatusCircle = memo(({ label, value, goal, type, goldMultiplier }) => {
      let progress, color;
      
      if (type === 'calories') {
        progress = getProgress(value, goal);
        color = getCalorieColor(value, goal);
      } else if (type === 'protein') {
        progress = getProgress(value, goal);
        color = getProteinColor(value, goal);
      } else {
        progress = getProgress(value, goal);
        color = getProgressColor(value, goal, goldMultiplier);
      }

      const circumference = 2 * Math.PI * 45;
      const strokeDashoffset = circumference - (progress / 100) * circumference;

      return (
        <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
          <div style={{ position: 'relative', width: '96px', height: '96px' }}>
            <svg style={{ width: '96px', height: '96px', transform: 'rotate(-90deg)' }}>
              <circle cx="48" cy="48" r="45" stroke="#fce7f3" strokeWidth="8" fill="none" />
              <circle cx="48" cy="48" r="45" stroke={color} strokeWidth="8" fill="none"
                strokeDasharray={circumference} strokeDashoffset={strokeDashoffset}
                strokeLinecap="round" style={{ transition: 'all 0.5s' }} />
            </svg>
            <div style={{ position: 'absolute', inset: 0, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#1f2937' }}>{value}</div>
              <div style={{ fontSize: '12px', color: '#6b7280' }}>/{goal}</div>
            </div>
          </div>
          <div style={{ fontSize: '14px', color: '#4b5563', marginTop: '8px' }}>{label}</div>
        </div>
      );
    });

    // HomePage component - OUTSIDE DailyCheck for better performance
    const HomePage = memo(({ today, setToday, goals, tempMeal, setTempMeal, tempWorkout, setTempWorkout }) => {
      
      const handleAddMeal = useCallback(() => {
        if (tempMeal.calories > 0 || tempMeal.protein > 0) {
          setToday(prev => ({
            ...prev,
            meals: [...prev.meals, tempMeal],
            calories: prev.calories + tempMeal.calories,
            protein: prev.protein + tempMeal.protein
          }));
          setTempMeal({ calories: 0, protein: 0 });
        }
      }, [tempMeal, setToday, setTempMeal]);

      const handleAddWorkout = useCallback(() => {
        const caloriesBurned = tempWorkout.duration * goals.calorieBurn[tempWorkout.type];
        setToday(prev => ({
          ...prev,
          workouts: [...prev.workouts, { ...tempWorkout, calories: caloriesBurned }],
          workoutMinutes: prev.workoutMinutes + tempWorkout.duration
        }));
      }, [tempWorkout, goals.calorieBurn, setToday]);

      return (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '32px', paddingBottom: '96px' }}>
          {/* Status Circles */}
          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px', marginBottom: '24px' }}>
              <StatusCircle label="Kcal" value={today.calories} goal={goals.calories} type="calories" goldMultiplier={goals.goldMultiplier} />
              <StatusCircle label="Protein" value={today.protein} goal={goals.protein} type="protein" goldMultiplier={goals.goldMultiplier} />
              <StatusCircle label="Trening" value={today.workoutMinutes} goal={goals.workout} goldMultiplier={goals.goldMultiplier} />
            </div>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px' }}>
              <StatusCircle label="Pushups" value={today.pushups} goal={goals.pushups} goldMultiplier={goals.goldMultiplier} />
              <StatusCircle label="Planke" value={today.plank} goal={goals.plank} goldMultiplier={goals.goldMultiplier} />
            </div>
          </div>

          {/* Kosthold */}
          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' }}>Kosthold</h3>
            
            <div style={{ marginBottom: '24px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                <span style={{ color: '#4b5563' }}>Kalorier</span>
                <input
                  key={`cal-${tempMeal.calories}`}
                  type="number"
                  defaultValue={tempMeal.calories}
                  onBlur={(e) => setTempMeal(prev => ({...prev, calories: parseInt(e.target.value) || 0}))}
                  inputMode="numeric"
                  style={{
                    backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '24px', fontWeight: 'bold',
                    padding: '8px 16px', borderRadius: '12px', width: '128px', textAlign: 'center', border: '2px solid #fbcfe8'
                  }}
                />
              </div>
              <input
                type="range" min="0" max="2000" step="50" value={tempMeal.calories}
                onInput={(e) => setTempMeal(prev => ({...prev, calories: parseInt(e.target.value)}))}
                style={{ width: '100%' }}
              />
            </div>

            <div style={{ marginBottom: '24px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                <span style={{ color: '#4b5563' }}>Protein (g)</span>
                <input
                  key={`pro-${tempMeal.protein}`}
                  type="number"
                  defaultValue={tempMeal.protein}
                  onBlur={(e) => setTempMeal(prev => ({...prev, protein: parseInt(e.target.value) || 0}))}
                  inputMode="numeric"
                  style={{
                    backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '24px', fontWeight: 'bold',
                    padding: '8px 16px', borderRadius: '12px', width: '128px', textAlign: 'center', border: '2px solid #fbcfe8'
                  }}
                />
              </div>
              <input
                type="range" min="0" max="200" step="1" value={tempMeal.protein}
                onInput={(e) => setTempMeal(prev => ({...prev, protein: parseInt(e.target.value)}))}
                style={{ width: '100%' }}
              />
            </div>

            <button onClick={handleAddMeal}
              style={{
                width: '100%', backgroundColor: '#fb7185', color: 'white', fontWeight: 'bold',
                padding: '16px', borderRadius: '16px', border: 'none', cursor: 'pointer', boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
              }}
            >
              Legg til m√•ltid
            </button>

            {today.meals.length > 0 && (
              <div style={{ marginTop: '24px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                  <span style={{ fontSize: '14px', color: '#6b7280' }}>I dag ({today.meals.length} m√•ltid{today.meals.length !== 1 ? 'er' : ''})</span>
                  <div style={{ fontSize: '14px', color: '#6b7280' }}>
                    <span style={{ color: '#1f2937', fontWeight: 'bold' }}>{today.calories}</span> kcal / 
                    <span style={{ color: '#1f2937', fontWeight: 'bold' }}> {today.protein}</span>g protein
                  </div>
                </div>
                {today.meals.map((meal, idx) => (
                  <div key={idx} style={{ backgroundColor: '#fce7f3', padding: '12px', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', border: '1px solid #fbcfe8', marginBottom: '8px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <span style={{ fontSize: '24px' }}>üçΩÔ∏è</span>
                      <div>
                        <div style={{ color: '#1f2937', fontWeight: '500' }}>{meal.calories} kcal</div>
                        <div style={{ fontSize: '12px', color: '#6b7280' }}>{meal.protein}g protein</div>
                      </div>
                    </div>
                    <button
                      onClick={() => {
                        setToday(prev => ({
                          ...prev,
                          meals: prev.meals.filter((_, i) => i !== idx),
                          calories: prev.calories - meal.calories,
                          protein: prev.protein - meal.protein
                        }));
                      }}
                      style={{ color: '#f43f5e', fontSize: '14px', fontWeight: '500', background: 'none', border: 'none', cursor: 'pointer' }}
                    >
                      Slett
                    </button>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Trening */}
          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' }}>Trening</h3>
            
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px', marginBottom: '24px' }}>
              {Object.entries(workoutIcons).map(([type, icon]) => (
                <button key={type} onClick={() => setTempWorkout(prev => ({...prev, type}))}
                  style={{ padding: '16px', borderRadius: '16px', fontSize: '36px',
                    backgroundColor: tempWorkout.type === type ? '#f9a8d4' : '#fce7f3',
                    border: tempWorkout.type === type ? 'none' : '1px solid #fbcfe8', cursor: 'pointer' }}>
                  {icon}
                </button>
              ))}
            </div>

            <div style={{ marginBottom: '24px' }}>
              <div style={{ fontSize: '14px', color: '#6b7280', marginBottom: '12px' }}>Intensitet</div>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px' }}>
                {['low', 'moderate', 'high'].map((intensity) => (
                  <button key={intensity} onClick={() => setTempWorkout(prev => ({...prev, intensity}))}
                    style={{ padding: '12px', borderRadius: '12px', fontWeight: '500',
                      backgroundColor: intensityColors[intensity], color: '#1f2937', border: 'none', cursor: 'pointer',
                      opacity: tempWorkout.intensity === intensity ? 1 : 0.6 }}>
                    {intensity === 'low' ? 'Lav' : intensity === 'moderate' ? 'Moderat' : 'H√∏y'}
                  </button>
                ))}
              </div>
            </div>

            <div style={{ marginBottom: '24px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                <span style={{ color: '#4b5563' }}>Varighet</span>
                <span style={{ fontSize: '30px', fontWeight: 'bold', color: '#1f2937' }}>{tempWorkout.duration} min</span>
              </div>
              <input
                type="range" min="5" max="120" step="5" value={tempWorkout.duration}
                onInput={(e) => setTempWorkout(prev => ({...prev, duration: parseInt(e.target.value)}))}
                style={{ width: '100%' }}
              />
            </div>

            <button onClick={handleAddWorkout}
              style={{ width: '100%', backgroundColor: '#fb7185', color: 'white', fontWeight: 'bold',
                padding: '16px', borderRadius: '16px', border: 'none', cursor: 'pointer', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}
            >
              Legg til √∏kt
            </button>

            {today.workouts.length > 0 && (
              <div style={{ marginTop: '24px' }}>
                <div style={{ fontSize: '14px', color: '#6b7280', marginBottom: '8px' }}>I dag ({today.workouts.length} √∏kter)</div>
                {today.workouts.map((workout, idx) => (
                  <div key={idx} style={{ backgroundColor: '#fce7f3', padding: '12px', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', border: '1px solid #fbcfe8', marginBottom: '8px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <span style={{ fontSize: '24px' }}>{workoutIcons[workout.type]}</span>
                      <div>
                        <div style={{ color: '#1f2937', fontWeight: '500' }}>{workout.duration} min / {workout.calories} kcal</div>
                        <div style={{ fontSize: '12px', color: '#6b7280', textTransform: 'capitalize' }}>{workout.intensity}</div>
                      </div>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                      <div style={{ width: '12px', height: '12px', borderRadius: '50%', backgroundColor: intensityColors[workout.intensity] }} />
                      <button
                        onClick={() => {
                          setToday(prev => ({
                            ...prev,
                            workouts: prev.workouts.filter((_, i) => i !== idx),
                            workoutMinutes: prev.workoutMinutes - workout.duration
                          }));
                        }}
                        style={{ color: '#f43f5e', fontSize: '14px', fontWeight: '500', background: 'none', border: 'none', cursor: 'pointer' }}
                      >
                        Slett
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Styrke */}
          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' }}>Styrke</h3>
            
            <div style={{ marginBottom: '24px' }}>
              <div style={{ color: '#4b5563', marginBottom: '12px' }}>Pushups</div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                <button onClick={() => setToday(prev => ({...prev, pushups: Math.max(0, prev.pushups - 1)}))}
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', width: '56px', height: '56px', borderRadius: '16px',
                    display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px', border: '1px solid #fbcfe8', cursor: 'pointer' }}>
                  <Minus />
                </button>
                <div style={{ flex: 1, textAlign: 'center' }}>
                  <input type="number" value={today.pushups} 
                    onChange={(e) => setToday(prev => ({...prev, pushups: parseInt(e.target.value) || 0}))}
                    inputMode="numeric"
                    style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '36px', fontWeight: 'bold',
                      padding: '12px 16px', borderRadius: '16px', width: '100%', textAlign: 'center', border: '2px solid #fbcfe8' }}
                  />
                </div>
                <button onClick={() => setToday(prev => ({...prev, pushups: prev.pushups + 1}))}
                  style={{ backgroundColor: '#fb7185', color: 'white', width: '56px', height: '56px', borderRadius: '16px',
                    display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px', border: 'none', cursor: 'pointer', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                  <Plus />
                </button>
              </div>
            </div>

            <div>
              <div style={{ color: '#4b5563', marginBottom: '12px' }}>Planke (sekunder)</div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                <button onClick={() => setToday(prev => ({...prev, plank: Math.max(0, prev.plank - 10)}))}
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', width: '56px', height: '56px', borderRadius: '16px',
                    display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px', border: '1px solid #fbcfe8', cursor: 'pointer' }}>
                  <Minus />
                </button>
                <div style={{ flex: 1, textAlign: 'center' }}>
                  <input type="number" value={today.plank}
                    onChange={(e) => setToday(prev => ({...prev, plank: parseInt(e.target.value) || 0}))}
                    inputMode="numeric"
                    style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '36px', fontWeight: 'bold',
                      padding: '12px 16px', borderRadius: '16px', width: '100%', textAlign: 'center', border: '2px solid #fbcfe8' }}
                  />
                </div>
                <button onClick={() => setToday(prev => ({...prev, plank: prev.plank + 10}))}
                  style={{ backgroundColor: '#fb7185', color: 'white', width: '56px', height: '56px', borderRadius: '16px',
                    display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px', border: 'none', cursor: 'pointer', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                  <Plus />
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    });

    // HistoryPage component - OUTSIDE DailyCheck
    const HistoryPage = memo(({ history, goals }) => {
      const getCurrentStreak = () => {
        let streak = 0;
        let currentDate = new Date();
        
        for (let i = 0; i < 100; i++) {
          const dateStr = currentDate.toDateString();
          if (history[dateStr] && getActivityScore(history[dateStr], goals) > 30) {
            streak++;
            currentDate.setDate(currentDate.getDate() - 1);
          } else {
            break;
          }
        }
        return streak;
      };

      const getWeekComparison = () => {
        const now = new Date();
        let thisWeek = { pushups: 0, workout: 0 };
        let lastWeek = { pushups: 0, workout: 0 };
        
        for (let i = 0; i < 14; i++) {
          const date = new Date(now);
          date.setDate(date.getDate() - i);
          const data = history[date.toDateString()];
          
          if (data) {
            if (i < 7) {
              thisWeek.pushups += data.pushups || 0;
              thisWeek.workout += data.workoutMinutes || 0;
            } else {
              lastWeek.pushups += data.pushups || 0;
              lastWeek.workout += data.workoutMinutes || 0;
            }
          }
        }
        
        return { pushups: { current: thisWeek.pushups, previous: lastWeek.pushups }, workout: { current: thisWeek.workout, previous: lastWeek.workout } };
      };

      const getLast28Days = () => {
        const days = [];
        const today = new Date();
        for (let i = 27; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const dateStr = date.toDateString();
          const dayData = history[dateStr];
          const score = getActivityScore(dayData, goals);
          days.push({ date: dateStr, score, color: getActivityColor(score) });
        }
        return days;
      };

      const streak = getCurrentStreak();
      const weekComp = getWeekComparison();
      
      return (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px', paddingBottom: '96px' }}>
          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <Flame style={{ color: '#fb7185' }} />
              <div>
                <div style={{ fontSize: '30px', fontWeight: 'bold', color: '#1f2937' }}>{streak} dager</div>
                <div style={{ fontSize: '14px', color: '#6b7280' }}>Current streak</div>
              </div>
            </div>
          </div>

          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' }}>Denne uken vs forrige</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ color: '#4b5563' }}>Pushups</span>
                <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                  <span style={{ color: '#9ca3af' }}>{weekComp.pushups.previous}</span>
                  <TrendingUp style={{ color: weekComp.pushups.current >= weekComp.pushups.previous ? '#86efac' : '#fb7185' }} />
                  <span style={{ color: '#1f2937', fontWeight: 'bold' }}>{weekComp.pushups.current}</span>
                </div>
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ color: '#4b5563' }}>Trening (min)</span>
                <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                  <span style={{ color: '#9ca3af' }}>{weekComp.workout.previous}</span>
                  <TrendingUp style={{ color: weekComp.workout.current >= weekComp.workout.previous ? '#86efac' : '#fb7185' }} />
                  <span style={{ color: '#1f2937', fontWeight: 'bold' }}>{weekComp.workout.current}</span>
                </div>
              </div>
            </div>
          </div>

          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' }}>Aktivitet (siste 28 dager)</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '8px' }}>
              {getLast28Days().map((day, i) => (
                <div key={i} style={{ aspectRatio: '1', borderRadius: '8px', backgroundColor: day.color, border: '1px solid #fbcfe8' }} />
              ))}
            </div>
          </div>
        </div>
      );
    });

    // SettingsPage component - OUTSIDE DailyCheck
    const SettingsPage = memo(({ goals, setGoals, settingsExpanded, setSettingsExpanded }) => {
      return (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px', paddingBottom: '96px' }}>
          <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
            <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#1f2937', marginBottom: '24px' }}>Daglige m√•l</h3>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
              <div>
                <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Kalorier (kcal)</label>
                <input type="number" defaultValue={goals.calories}
                  onBlur={(e) => setGoals(prev => ({...prev, calories: parseInt(e.target.value) || 0}))}
                  onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                  inputMode="numeric"
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                    padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                />
              </div>

              <div>
                <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Protein (g)</label>
                <input type="number" defaultValue={goals.protein}
                  onBlur={(e) => setGoals(prev => ({...prev, protein: parseInt(e.target.value) || 0}))}
                  onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                  inputMode="numeric"
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                    padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                />
              </div>

              <div>
                <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Trening (minutter)</label>
                <input type="number" defaultValue={goals.workout}
                  onBlur={(e) => setGoals(prev => ({...prev, workout: parseInt(e.target.value) || 0}))}
                  onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                  inputMode="numeric"
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                    padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                />
              </div>

              <div>
                <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Pushups</label>
                <input type="number" defaultValue={goals.pushups}
                  onBlur={(e) => setGoals(prev => ({...prev, pushups: parseInt(e.target.value) || 0}))}
                  onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                  inputMode="numeric"
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                    padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                />
              </div>

              <div>
                <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Planke (sekunder)</label>
                <input type="number" defaultValue={goals.plank}
                  onBlur={(e) => setGoals(prev => ({...prev, plank: parseInt(e.target.value) || 0}))}
                  onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                  inputMode="numeric"
                  style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                    padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                />
              </div>
            </div>
          </div>

          <button onClick={() => setSettingsExpanded(!settingsExpanded)}
            style={{ width: '100%', backgroundColor: 'white', color: '#1f2937', fontWeight: '500',
              padding: '16px', borderRadius: '16px', border: '1px solid #fbcfe8', cursor: 'pointer', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}
          >
            {settingsExpanded ? 'Skjul avanserte innstillinger' : 'Avanserte innstillinger'}
          </button>

          {settingsExpanded && (
            <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                <div>
                  <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Kalori-sone bredde (¬±kcal)</label>
                  <input type="number" defaultValue={goals.calorieZone}
                    onBlur={(e) => setGoals(prev => ({...prev, calorieZone: parseInt(e.target.value) || 0}))}
                    onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                    inputMode="numeric"
                    style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                      padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                  />
                </div>

                <div>
                  <label style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px', display: 'block' }}>Gull-multiplikator (√ó m√•l)</label>
                  <input type="number" step="0.1" defaultValue={goals.goldMultiplier}
                    onBlur={(e) => setGoals(prev => ({...prev, goldMultiplier: parseFloat(e.target.value) || 1}))}
                    onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                    inputMode="decimal"
                    style={{ backgroundColor: '#fce7f3', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                      padding: '12px 16px', borderRadius: '12px', width: '100%', border: '2px solid #fbcfe8' }}
                  />
                </div>

                <div>
                  <h4 style={{ color: '#4b5563', fontSize: '14px', marginBottom: '12px' }}>Kaloriforbruk per minutt</h4>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    {[
                      { key: 'run', icon: 'üèÉ', name: 'L√∏ping' },
                      { key: 'strength', icon: 'üí™', name: 'Styrke' },
                      { key: 'padel', icon: 'üéæ', name: 'Padel' }
                    ].map(item => (
                      <div key={item.key} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                        backgroundColor: '#fce7f3', padding: '12px', borderRadius: '12px', border: '1px solid #fbcfe8' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                          <span style={{ fontSize: '24px' }}>{item.icon}</span>
                          <span style={{ color: '#1f2937' }}>{item.name}</span>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <input type="number" defaultValue={goals.calorieBurn[item.key]}
                            onBlur={(e) => setGoals(prev => ({
                              ...prev,
                              calorieBurn: {...prev.calorieBurn, [item.key]: parseInt(e.target.value) || 0}
                            }))}
                            onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur() }}
                            inputMode="numeric"
                            style={{ backgroundColor: 'white', color: '#1f2937', fontSize: '18px', fontWeight: 'bold',
                              padding: '8px 12px', borderRadius: '8px', width: '80px', textAlign: 'center', border: '1px solid #fbcfe8' }}
                          />
                          <span style={{ color: '#6b7280', fontSize: '14px' }}>kcal/min</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    });

    // Main DailyCheck component with state management
    function DailyCheck() {
      const [activeTab, setActiveTab] = useState('home');
      const [settingsExpanded, setSettingsExpanded] = useState(false);
      
      const [goals, setGoals] = useState(() => {
        const saved = localStorage.getItem('dailyCheckGoals');
        return saved ? JSON.parse(saved) : {
          calories: 2000, protein: 130, workout: 30, pushups: 50, plank: 60,
          calorieZone: 300, goldMultiplier: 1.5,
          calorieBurn: { run: 10, strength: 6, padel: 8 }
        };
      });

      const [today, setToday] = useState(() => {
        const todayDate = new Date().toDateString();
        const saved = localStorage.getItem('dailyCheckToday');
        const savedData = saved ? JSON.parse(saved) : null;
        
        if (savedData && savedData.date === todayDate) {
          return savedData.data;
        }
        
        return { calories: 0, protein: 0, workoutMinutes: 0, workouts: [], meals: [], pushups: 0, plank: 0 };
      });

      const [history, setHistory] = useState(() => {
        const saved = localStorage.getItem('dailyCheckHistory');
        return saved ? JSON.parse(saved) : {};
      });

      const [tempMeal, setTempMeal] = useState({ calories: 0, protein: 0 });
      const [tempWorkout, setTempWorkout] = useState({ type: 'run', duration: 30, intensity: 'moderate' });

      useEffect(() => {
        localStorage.setItem('dailyCheckGoals', JSON.stringify(goals));
      }, [goals]);

      useEffect(() => {
        const todayDate = new Date().toDateString();
        localStorage.setItem('dailyCheckToday', JSON.stringify({ date: todayDate, data: today }));
        
        const timer = setTimeout(() => {
          const newHistory = {...history};
          newHistory[todayDate] = {
            calories: today.calories, protein: today.protein, workoutMinutes: today.workoutMinutes,
            pushups: today.pushups, plank: today.plank
          };
          setHistory(newHistory);
          localStorage.setItem('dailyCheckHistory', JSON.stringify(newHistory));
        }, 1000);
        
        return () => clearTimeout(timer);
      }, [today]);

      return (
        <div style={{ minHeight: '100vh', backgroundColor: '#fce7f3', color: '#1f2937' }}>
          <div style={{ maxWidth: '448px', margin: '0 auto', padding: '24px 16px' }}>
            <div style={{ marginBottom: '32px' }}>
              <h1 style={{ fontSize: '30px', fontWeight: 'bold', color: '#1f2937' }}>Daily Check</h1>
              <p style={{ color: '#6b7280', fontSize: '14px' }}>
                {new Date().toLocaleDateString('nb-NO', { weekday: 'long', day: 'numeric', month: 'long' })}
              </p>
            </div>

            {activeTab === 'home' && (
              <HomePage 
                today={today}
                setToday={setToday}
                goals={goals}
                tempMeal={tempMeal}
                setTempMeal={setTempMeal}
                tempWorkout={tempWorkout}
                setTempWorkout={setTempWorkout}
              />
            )}
            {activeTab === 'history' && <HistoryPage history={history} goals={goals} />}
            {activeTab === 'settings' && (
              <SettingsPage 
                goals={goals}
                setGoals={setGoals}
                settingsExpanded={settingsExpanded}
                setSettingsExpanded={setSettingsExpanded}
              />
            )}

            {/* Bottom Navigation */}
            <div style={{ position: 'fixed', bottom: 0, left: 0, right: 0, backgroundColor: 'white', borderTop: '1px solid #fbcfe8' }}>
              <div style={{ maxWidth: '448px', margin: '0 auto', padding: '12px 16px' }}>
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '8px' }}>
                  <button onClick={() => setActiveTab('home')}
                    style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '12px', borderRadius: '16px',
                      backgroundColor: activeTab === 'home' ? '#fb7185' : 'transparent',
                      color: activeTab === 'home' ? 'white' : '#6b7280', border: 'none', cursor: 'pointer' }}>
                    <Play />
                    <span style={{ fontSize: '12px', marginTop: '4px' }}>Hjem</span>
                  </button>
                  <button onClick={() => setActiveTab('history')}
                    style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '12px', borderRadius: '16px',
                      backgroundColor: activeTab === 'history' ? '#fb7185' : 'transparent',
                      color: activeTab === 'history' ? 'white' : '#6b7280', border: 'none', cursor: 'pointer' }}>
                    <Calendar />
                    <span style={{ fontSize: '12px', marginTop: '4px' }}>Historikk</span>
                  </button>
                  <button onClick={() => setActiveTab('settings')}
                    style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '12px', borderRadius: '16px',
                      backgroundColor: activeTab === 'settings' ? '#fb7185' : 'transparent',
                      color: activeTab === 'settings' ? 'white' : '#6b7280', border: 'none', cursor: 'pointer' }}>
                    <Settings />
                    <span style={{ fontSize: '12px', marginTop: '4px' }}>Innstillinger</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DailyCheck />);
  </script>
</body>
</html>
